# Feeds

The Indexer can provide realtime data through its WebSockets endpoint.

Below we provide an example of how to establish a connection and watch realtime trades updates. See the full API specification [here](/indexer-client/websockets).

::::steps

## Connect

To get realtime updates, we first need to establish a connection with the WebSockets endpoint.

:::code-group

```python [Python]
# The message handler, triggered when a message is received.
def handler(ws: IndexerSocket, message: dict):
    print(message)
# Create a socket and establish the connection.
socket = IndexerSocket(TESTNET.websocket_indexer, on_message=handler).connect()
```

```typescript [TypeScript]
// The message handler, triggered when a message is received.
function handler(message) {
  console.log(message);
}
// Create a socket.
const mySocket = new SocketClient(
  Network.testnet().indexerConfig,
  // On-connection callback
  () => { console.log('socket opened'); },
  // On-disconnection callback
  () => { console.log('socket closed'); },
  // Message handler
  (message) => { handler(message); },
  // WebSockets event handler
  (event) => { console.error('Encountered error:', event.message); },
);
// Establish the connection.
mySocket.connect();
```

```rust [Rust]
// Establish the connection.
let mut indexer = IndexerClient::new(config.indexer);
```

:::


Upon a successful connection you will receive an initial connection message.
This message maybe abstracted away, depending on the client.

:::details[Connection response]
```tsx
{
  "type": "connected",
  "connection_id": "004a1efa-21bb-4b19-a2e9-a8ffadd6dc53",
  "message_id": 0
}
```
:::

## Subscribe

You may subscribe to any channel following the subscribe instructions above. Subscribing to a channel has the following fields:

- `type` - Should always be specified to `subscribe`
- `channel` - Specifies the channel you are subscribing to. The specific string is specified in each channel’s documentation
- `id` - required for all channels other than market. Specifies the market or subaccount you are subscribing to.

:::code-group

```python [Python]
def handler(ws: IndexerSocket, message: dict):
    print(message)

socket = IndexerSocket(TESTNET.websocket_indexer, on_message=handler).connect() # [!code focus]
```

```typescript [TypeScript]
const mySocket = new SocketClient(
  Network.testnet().indexerConfig,
  () => {
    console.log('socket opened');
  },
  () => {
    console.log('socket closed');
  },
  (message) => {
    console.log(message);
  },
  (event) => {
    console.error('Encountered error:', event.message);
  },
);
mySocket.connect();
```

```rust [Rust]
let mut indexer = IndexerClient::new(config.indexer);
let feeds = indexer.feeds(); // [!code focus]
```

:::

## Unsubscribe

Utilize the same message to subscribe but replace the type with `unsubscribe`. For example:
`{ "type": "unsubscribe", "channel": "v4_trades", "id": "BTC-USD" }`

:::code-group

```python [Python]
def handler(ws: IndexerSocket, message: dict):
    print(message)

socket = IndexerSocket(TESTNET.websocket_indexer, on_message=handler).connect() # [!code focus]
```

```typescript [TypeScript]
const mySocket = new SocketClient(
  Network.testnet().indexerConfig,
  () => {
    console.log('socket opened');
  },
  () => {
    console.log('socket closed');
  },
  (message) => {
    console.log(message);
  },
  (event) => {
    console.error('Encountered error:', event.message);
  },
);
mySocket.connect();
```

```rust [Rust]
let mut indexer = IndexerClient::new(config.indexer);
let feeds = indexer.feeds(); // [!code focus]
```

:::
::::

## Details

### Rate Limiting

The default rate limiting config for WebSockets is:
- 2 subscriptions per (connection + channel + channel ID) per second.
- 2 invalid messages per connection per second.

### Maintaining a Connection

Every 30 seconds, the WebSockets API will send a [heartbeat `ping` control frame](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#pings_and_pongs_the_heartbeat_of_websockets) to the connected client.
If a `pong` event is not received within 10 seconds back, the websocket API will disconnect.

### CLI example

You can use a command-line WebSockets client such as [`interactive-websocket-cli`](https://www.npmjs.com/package/interactive-websocket-cli) to connect and subscribe to channels.

Example (with `interactive-websocket-cli`):

```tsx
# For the deployment by DYDX token holders (mainnet), use
# wscli connect wss://indexer.dydx.trade/v4/ws
wscli connect wss://indexer.v4testnet.dydx.exchange/v4/ws
<output from ws-cli>
<type 's' to send> { "type": "subscribe", "channel": "v4_trades", "id": "BTC-USD" }
```

