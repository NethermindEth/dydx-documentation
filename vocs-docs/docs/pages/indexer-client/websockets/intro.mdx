# WebSockets

The WebSockets API provides data feeds providing the trader real-time information.

## Connect

:::code-group

```python [Python]
def handler(ws: IndexerSocket, message: dict):
    print(message)

socket = IndexerSocket(TESTNET.websocket_indexer, on_message=handler).connect() # [!code focus]
```

```typescript [TypeScript]
const mySocket = new SocketClient(
  Network.testnet().indexerConfig,
  () => {
    console.log('socket opened');
  },
  () => {
    console.log('socket closed');
  },
  (message) => {
    console.log(message);
  },
  (event) => {
    console.error('Encountered error:', event.message);
  },
);
mySocket.connect();
```

```rust [Rust]
let mut indexer = IndexerClient::new(config.indexer);
let feeds = indexer.feeds(); // [!code focus]
```

:::


Upon connecting to v4 Websockets you will receive an initial connection message with the following format:

```tsx
{
  "type": "connected",
  "connection_id": "004a1efa-21bb-4b19-a2e9-a8ffadd6dc53",
  "message_id": 0
}
```
## Maintaining a Connection

Every 30 seconds, the websocket API will send a [heartbeat ping control frame](https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#pings_and_pongs_the_heartbeat_of_websockets) to the connected client. If a pong event is not received within 10 seconds back, the websocket API will disconnect.

## Subscribe

You may subscribe to any channel following the subscribe instructions above. Subscribing to a channel has the following fields:

- `type` - Should always be specified to `subscribe`
- `channel` - Specifies the channel you are subscribing to. The specific string is specified in each channel’s documentation
- `id` - required for all channels other than market. Specifies the market or subaccount you are subscribing to.

## Rate Limiting

The default rate limiting config for websockets is:
- 2 subscriptions per (connection + channel + channel ID) per second.
- 2 invalid messages per connection per second.

## Unsubscribe

Utilize the same message to subscribe but replace the type with `unsubscribe`. For example:
`{ "type": "unsubscribe", "channel": "v4_trades", "id": "BTC-USD" }`

## Example

Use a command-line websocket client such as [interactive-websocket-cli](https://www.npmjs.com/package/interactive-websocket-cli) to connect and subscribe to channels.

Example (with `interactive-websocket-cli`)

```tsx
# For the deployment by DYDX token holders (mainnet), use
# wscli connect wss://indexer.dydx.trade/v4/ws
wscli connect wss://indexer.v4testnet.dydx.exchange/v4/ws
<output from ws-cli>
<type 's' to send> { "type": "subscribe", "channel": "v4_trades", "id": "BTC-USD" }
```
